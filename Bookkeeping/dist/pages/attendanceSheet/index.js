(wx.webpackJsonp=wx.webpackJsonp||[]).push([[35],{"124":function(t,e,o){t.exports=o.p+"pages/attendanceSheet/index.wxml"},"207":function(t,e,o){"use strict";o.r(e);o(208);var r=o(70);for(var n in r)"default"!==n&&function(t){o.d(e,t,(function(){return r[t]}))}(n)},"208":function(t,e,o){"use strict";o(124)},"209":function(t,e,o){},"23":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{"value":!0});var r,n,_slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,e){var o=[],r=!0,n=!1,a=void 0;try{for(var u,i=t[Symbol.iterator]();!(r=(u=i.next()).done)&&(o.push(u.value),!e||o.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}return o}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function defineProperties(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,o){return e&&defineProperties(t.prototype,e),o&&defineProperties(t,o),t}}(),u=o(0),i=function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}(u),l=o(2),s=o(4);function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}o(209);var m=(n=r=function(t){function AttendanceSheet(){var t,e,o;_classCallCheck(this,AttendanceSheet);for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return e=o=_possibleConstructorReturn(this,(t=AttendanceSheet.__proto__||Object.getPrototypeOf(AttendanceSheet)).call.apply(t,[this].concat(n))),o.config={"navigationBarTitleText":"考勤表"},o.$usedState=["$compid__77","tebArr","fixedTab","year","month"],o.customComponents=["CalendarModal"],_possibleConstructorReturn(o,e)}return function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{"constructor":{"value":t,"enumerable":!1,"writable":!0,"configurable":!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(AttendanceSheet,t),a(AttendanceSheet,[{"key":"_constructor","value":function _constructor(t){(function get(t,e,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var n=Object.getPrototypeOf(t);return null===n?void 0:get(n,e,o)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(o):void 0})(AttendanceSheet.prototype.__proto__||Object.getPrototypeOf(AttendanceSheet.prototype),"_constructor",this).call(this,t),this.$$refs=new i.default.RefsArray}},{"key":"_createData","value":function _createData(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var t=this.$prefix,e=(0,u.genCompid)(t+"$compid__77"),o=_slicedToArray(e,2),r=o[0],n=o[1],a=(0,u.useState)(""),m=_slicedToArray(a,2),h=(m[0],m[1]),f=(0,u.useState)(),c=_slicedToArray(f,2),p=c[0],_=c[1],v=(0,u.useState)(""),y=_slicedToArray(v,2),d=y[0],g=y[1],w=(0,u.useState)([]),b=_slicedToArray(w,2),k=b[0],S=b[1],A=(0,u.useState)([]),O=_slicedToArray(A,2),F=O[0],x=O[1],C=(0,u.useState)([{},{},{}]),j=_slicedToArray(C,2),I=(j[0],j[1],(0,u.useState)(0)),P=_slicedToArray(I,2),T=P[0],J=P[1],M=(0,u.useState)(!1),$=_slicedToArray(M,2),D=$[0],N=$[1],R=(0,u.useState)(0),E=_slicedToArray(R,2),B=E[0],L=E[1],Y=function handleShare(){N(!0)},q=function handleClose(){N(!1)},Z=function addZero(t){return parseInt(t)<10&&(t="0"+t),t};(0,u.useEffect)((function(){var t=i.default.getStorageSync(s.Type);J(t);var e=new Date,o=e.getFullYear()+"-"+Z(e.getMonth()+1),r=e.getFullYear(),n=Z(e.getMonth()+1);_(r),g(n),h(o),z(o)}),[]);var z=function getList(t){console.log(T,"identity");var e={"date":t},o=new Date(t),r=o.getMonth();o.setMonth(r+1),o.setDate(0);for(var n=o.getDate(),a=[],u=1;u<=n;u++){var i={"id":u,"name":u,"default":!0};a.push(i)}var s={"list":[{"id":"00","name":"本月统计","default":!0}].concat(a)},m=JSON.parse(JSON.stringify(F));0==B&&m.push(s);var h=JSON.parse(JSON.stringify(k)),f={"list":[{"id":1,"name":"工人","default":!0},{"id":2,"name":"记工类型","default":!0}]};0==h&&h.push(f);var c=[],p=[{"name":"总计","id":Math.random(),"default":!0},{"type":{"hour":!0,"work":!0,"amount":!0,"borrow":!0},"id":Math.random()}],_={};_.list=p,1===T&&c.push(_),(0,l.bkgetExcelDataAction)(e).then((function(t){if(200===t.code)if(t.data.length>0){var e=t.data,o=[],r=[],n=[],u=[],i=[],l=[];if(e.length>0)for(var s=0;s<e.length;s++){var f={},p={"name":0,"type":{}};p.type.amount="",p.type.hour={"work_time":"","over_time":""},p.type.work={"work_time":"","over_time":""},p.type.borrow="";var _=[],v={"name":e[s].name},y={},d=void 0;e[s].hour.length&&(d=!0);var g=void 0;e[s].work.length&&(g=!0);var w=void 0;e[s].amount.length&&(w=!0);var b=void 0;e[s].borrow.length&&(b=!0);var k={"hour":d,"work":g,"amount":w,"borrow":b};y.type=k,_.push(v,y),f.list=_,0===B&&o.push(f);for(var A=[],O=JSON.parse(JSON.stringify(a)),F=0;F<O.length;F++){O[F].type={};var C=0;if(e[s].hour.length>0){for(var j=[],I=0;I<e[s].hour.length;I++)if(j.push(e[s].hour[I].total),+e[s].hour[I].total.work_time,C+=+e[s].hour[I].total.over_time,e[s].hour[I].date_num==O[F].name&&e[s].hour[I].list&&e[s].hour[I].list.length>0)if(1==e[s].hour[I].list.length){var P={"work_time":e[s].hour[I].list[0].work_time,"over_time":e[s].hour[I].list[0].overtime};O[F].type.hour=P}else if(e[s].hour[I].list.length>1){var J={"num":e[s].hour[I].list.length+"笔"};O[F].type.hour=J}var M=0,$=0;if(j.length>0)for(var D=0;D<j.length;D++)j[D].work_time&&(M+=+j[D].work_time),j[D].over_time&&($+=+j[D].over_time);p.type.hour.work_time=M,p.type.hour.over_time=$}if(C,e[s].work.length>0){for(var N=[],R=0;R<e[s].work.length;R++)if(N.push(e[s].work[R].total),e[s].work[R].date_num==O[F].name&&e[s].work[R].list&&e[s].work[R].list.length>0)if(1==e[s].work[R].list.length){var E={"work_time":e[s].work[R].list[0].work_time,"over_time":e[s].work[R].list[0].overtime};O[F].type.work=E}else if(e[s].work[R].list.length>1){var Y={"num":e[s].work[R].list.length};O[F].type.work=Y}var q=0,Z=0;if(N.length>0)for(var z=0;z<N.length;z++)N[z].work_time&&(q+=+N[z].work_time),N[z].over_time&&(Z+=+N[z].over_time);p.type.work.work_time=q,p.type.work.over_time=Z}if(e[s].amount.length>0){for(var G=[],H=0;H<e[s].amount.length;H++)if(e[s].amount[H].date_num==O[F].name){if(e[s].amount[H].total.length>0)for(var K=0;K<e[s].amount[H].total.length;K++)G.push(e[s].amount[H].total[K]);if(e[s].amount[H].list&&e[s].amount[H].list.length>0)if(1==e[s].amount[H].list.length){var Q={"unit_num":e[s].amount[H].list[0].unit_num,"unit":e[s].amount[H].list[0].unit};O[F].type.amount=Q}else if(e[s].amount[H].list.length>1){var U={"num":e[s].amount[H].list.length+"笔"};O[F].type.amount=U}}var V=[];if(G.length>0){for(var W=0;W<G.length;W++)if(0===V.length)V.push(G[W]);else for(var X=0;X<V.length;X++)V[X].unit_name!==G[W].unit_name?V.push(G[W]):V[X].sum+=+G[W].sum;p.type.amount=V[0]}}if(e[s].borrow.length>0){for(var tt=[],et=0;et<e[s].borrow.length;et++)if(tt.push(e[s].borrow[et].total),e[s].borrow[et].date_num==O[F].name&&e[s].borrow[et].list&&e[s].borrow[et].list.length>0)if(1==e[s].borrow[et].list.length){var ot={"money":e[s].borrow[et].list[0].money};O[F].type.borrow=ot}else if(e[s].borrow[et].list.length>1){var rt={"num":e[s].borrow[et].list.length+"笔"};O[F].type.borrow=rt}var nt=0;if(tt.length>0)for(var at=0;at<tt.length;at++)tt[at].money&&(nt+=+tt[at].money);p.type.borrow=nt,p.type.borrow}}var ut=[p].concat(_toConsumableArray(O));A.push(ut);var it={"list":A[0]};0===B&&r.push(it);for(var lt=0;lt<e[s].hour.length;lt++)n.push(e[s].hour[lt]);for(var st=0;st<e[s].amount.length;st++)u.push(e[s].amount[st]);for(var mt=0;mt<e[s].work.length;mt++)i.push(e[s].work[mt]);for(var ht=0;ht<e[s].borrow.length;ht++)l.push(e[s].borrow[ht])}for(var ft=0,ct=0,pt=0,_t=0,vt=0,yt=0,dt="",gt=0;gt<r.length;gt++)0===r[gt].list[0].name&&(r[gt].list[0].type.borrow&&(ft+=+r[gt].list[0].type.borrow),Object.keys(r[gt].list[0].type.hour).length&&(ct+=+r[gt].list[0].type.hour.work_time,pt+=+r[gt].list[0].type.hour.over_time),Object.keys(r[gt].list[0].type.work).length&&(_t+=+r[gt].list[0].type.work.work_time,vt+=+r[gt].list[0].type.work.over_time),Object.keys(r[gt].list[0].type.amount).length&&(yt+=+r[gt].list[0].type.amount.sum,dt=r[gt].list[0].type.amount.unit_name));var wt={"list":[]},bt={"id":0,"type":{"amount":{"sum":yt,"unit_name":dt},"borrow":{"money":ft},"hour":{"work_time":ct.toFixed(2),"over_time":pt.toFixed(2)},"work":{"work_time":_t.toFixed(2),"over_time":vt.toFixed(2)}}};1===T&&wt.list.push(bt);for(var kt={},St=n.reduce((function(t,e){return!kt[e.date_num]&&(kt[e.date_num]=t.push(e)),t}),[]),At={},Ot=u.reduce((function(t,e){return!At[e.date_num]&&(At[e.date_num]=t.push(e)),t}),[]),Ft={},xt=i.reduce((function(t,e){return!Ft[e.date_num]&&(Ft[e.date_num]=t.push(e)),t}),[]),Ct={},jt=l.reduce((function(t,e){return!Ct[e.date_num]&&(Ct[e.date_num]=t.push(e)),t}),[]),It=0;It<n.length;It++)for(var Pt=0;Pt<St.length;Pt++)n[It].date_num===St[Pt].date_num&&(St[Pt].total.work_time+=parseInt(n[It].total.work_time),St[Pt].total.over_time+=parseInt(n[It].total.over_time));for(var Tt=0;Tt<i.length;Tt++)for(var Jt=0;Jt<xt.length;Jt++)i[Tt].date_num===xt[Jt].date_num&&(xt[Jt].total.work_time+=parseInt(i[Tt].total.work_time),xt[Jt].total.over_time+=parseInt(i[Tt].total.over_time));for(var Mt=0;Mt<l.length;Mt++)for(var $t=0;$t<jt.length;$t++)l[Mt].date_num===jt[$t].date_num&&(jt[$t].total.borrow+=+l[Mt].total.money);for(var Dt=0;Dt<u.length;Dt++)for(var Nt=0;Nt<Ot.length;Nt++)u[Dt].date_num===Ot[Nt].date_num&&(Ot[Nt].total[0].sum+=+u[Dt].total[0].sum,Ot[Nt].total[0].unit_name=u[Dt].total[0].unit_name);for(var Rt,Et=JSON.parse(JSON.stringify(a)),Bt=0;Bt<Et.length;Bt++){for(var Lt={"type":{"hour":{"over_time":"","work_time":""},"borrow":{"money":""},"work":{"over_time":"","work_time":""},"amount":{"sum":"","unit_name":""}}},Yt=0;Yt<St.length;Yt++)Et[Bt].name===St[Yt].date_num&&(Lt.type.hour.over_time=parseInt(St[Yt].total.over_time).toFixed(2),Lt.type.hour.work_time=parseInt(St[Yt].total.work_time).toFixed(2));for(var qt=0;qt<xt.length;qt++)Et[Bt].name===xt[qt].date_num&&(Lt.type.work.over_time=parseInt(xt[qt].total.over_time).toFixed(2),Lt.type.work.work_time=parseInt(xt[qt].total.work_time).toFixed(2));for(var Zt=0;Zt<jt.length;Zt++)Et[Bt].name===jt[Zt].date_num&&(Lt.name=jt[Zt].date_num,Lt.type.borrow.money=jt[Zt].total.money);for(var zt=0;zt<Ot.length;zt++)Et[Bt].name===Ot[zt].date_num&&(Lt.name=Ot[zt].date_num,console.log(Ot[zt].total[0].unit_name,"daySums[j]"),Lt.type.amount.sum=parseInt(Ot[zt].total[0].sum),Lt.type.amount.unit_name=Ot[zt].total[0].unit_name);Et[Bt]=Lt}if(1===T)(Rt=wt.list).push.apply(Rt,_toConsumableArray(Et));r.push(wt),console.log(m,"tebArrList"),console.log(r,"rightData"),S([].concat(_toConsumableArray(h),o,c)),x([].concat(_toConsumableArray(m),r)),L(B+1)}else L(0)}))},G=function handleTime(t){var e=t.detail.value;S([]),x([]),_(t.detail.value.slice(0,4)),g(t.detail.value.slice(5,8)),z(e)},H=function userRouteJump(t){i.default.navigateTo({"url":t})};return console.log(F.length,"tebArr"),(0,u.useShareAppMessage)((function(){return{"title":"记工记账怕丢失？用鱼泡网记工，方便安全！数据永不丢失~","path":"/pages/share/index"}})),this.anonymousFunc0=function(t){return G(t)},this.anonymousFunc1=Y,this.anonymousFunc2=function(){return H("/pages/recorder/index")},this.anonymousFunc3=function(){return H("/pages/recorder/index")},u.propsManager.set({"display":D,"handleClose":q},n,r),Object.assign(this.__state,{"$compid__77":n,"tebArr":F,"fixedTab":k,"year":p,"month":d}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(t){}},{"key":"anonymousFunc1","value":function anonymousFunc1(t){}},{"key":"anonymousFunc2","value":function anonymousFunc2(t){}},{"key":"anonymousFunc3","value":function anonymousFunc3(t){}}]),AttendanceSheet}(i.default.Component),r.$$events=["anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3"],r.$$componentPath="pages/attendanceSheet/index",n);m.config={"navigationBarTitleText":"考勤表"},e.default=m,Component(o(0).default.createComponent(m,!0))},"70":function(t,e,o){"use strict";o.r(e);var r=o(23),n=o.n(r);for(var a in r)"default"!==a&&function(t){o.d(e,t,(function(){return r[t]}))}(a);e.default=n.a}},[[207,0,1,2,3]]]);